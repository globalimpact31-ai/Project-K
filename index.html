<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zoner Games - Arcade Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
            overflow-x: hidden;
            user-select: none; /* Prevents highlighting text while playing */
        }

        h1, h2, h3, .brand-font { font-family: 'Orbitron', sans-serif; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 4px; }

        /* Animations */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .animate-float { animation: float 4s ease-in-out infinite; }
        
        .card-hover:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        /* Neon Text Effects */
        .neon-text-blue { text-shadow: 0 0 10px #3b82f6, 0 0 20px #3b82f6; }
        .neon-text-purple { text-shadow: 0 0 10px #a855f7, 0 0 20px #a855f7; }
        .neon-text-green { text-shadow: 0 0 10px #22c55e, 0 0 20px #22c55e; }

        /* Game Overlay */
        #game-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.98); /* Slightly darker for focus */
            z-index: 50;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        canvas {
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            border-radius: 8px;
            max-width: 95%;
            max-height: 80vh;
            cursor: crosshair;
        }
        
        /* Memory Game Grid */
        .grid-game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            max-width: 90vw;
            width: 400px;
        }
        
        .memory-card {
            aspect-ratio: 1;
            background: #1e293b;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            transition: all 0.3s;
            border: 2px solid #334155;
        }
        .memory-card.flipped {
            background: #3b82f6;
            border-color: #60a5fa;
            transform: rotateY(180deg);
        }
        .memory-card.matched {
            background: #22c55e;
            border-color: #4ade80;
            opacity: 0.8;
            cursor: default;
        }

    </style>
</head>
<body class="antialiased selection:bg-blue-500 selection:text-white">

    <!-- Debug Script: Alerts user if code crashes -->
    <script>
        window.onerror = function(msg, url, line) {
            // Only alert if it's not a resize observer error (common harmless browser noise)
            if(!msg.includes("ResizeObserver")) {
                alert("Game Error: " + msg + "\nLine: " + line);
            }
        };
    </script>

    <!-- Navigation -->
    <nav class="fixed w-full z-40 bg-slate-900/90 backdrop-blur-md border-b border-slate-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-2">
                    <span class="text-2xl font-bold brand-font tracking-wider text-white">ZONER</span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-8">
                        <a href="#reflex-zone" class="hover:text-blue-400 transition-colors px-3 py-2 rounded-md text-sm font-medium">Reflex</a>
                        <a href="#mind-zone" class="hover:text-purple-400 transition-colors px-3 py-2 rounded-md text-sm font-medium">Mind</a>
                        <a href="#zen-zone" class="hover:text-green-400 transition-colors px-3 py-2 rounded-md text-sm font-medium">Zen</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="relative pt-32 pb-20 sm:pt-40 sm:pb-24 overflow-hidden">
        <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center z-10">
            <h1 class="text-5xl md:text-7xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-purple-400 to-blue-400 mb-6 animate-float">
                ENTER THE ZONE
            </h1>
            <p class="mt-4 text-xl text-slate-400 max-w-2xl mx-auto">
                Three dimensions of browser gaming.
            </p>
            <div class="mt-10 flex justify-center gap-4">
                <a href="#reflex-zone" class="px-8 py-3 rounded-full bg-blue-600 hover:bg-blue-500 text-white font-bold transition shadow-[0_0_20px_rgba(59,130,246,0.5)]">Start Playing</a>
            </div>
        </div>
    </div>

    <!-- Game Zones Container -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 space-y-24 pb-40">

        <!-- Zone 1: Reflex -->
        <section id="reflex-zone" class="scroll-mt-24">
            <div class="flex flex-col md:flex-row items-center gap-12">
                <div class="flex-1 space-y-6">
                    <h2 class="text-4xl font-bold text-white neon-text-blue">Reflex Zone</h2>
                    <p class="text-slate-400 text-lg">In <span class="text-white font-semibold">Neon Aim</span>, click targets before they fade.</p>
                    <button onclick="gameManager.start('reflex')" class="px-6 py-3 bg-slate-800 hover:bg-blue-600 border border-slate-700 hover:border-blue-500 text-white rounded-lg transition-all duration-300 flex items-center gap-2 group w-full md:w-auto justify-center">
                        Play Neon Aim
                    </button>
                </div>
                <div class="flex-1 w-full relative cursor-pointer" onclick="gameManager.start('reflex')">
                    <div class="absolute inset-0 bg-blue-600 rounded-2xl blur opacity-20"></div>
                    <div class="relative bg-slate-800 rounded-2xl p-2 border border-slate-700 aspect-video flex items-center justify-center hover:scale-[1.02] transition">
                        <h3 class="text-2xl font-bold text-white">PLAY NOW</h3>
                    </div>
                </div>
            </div>
        </section>

        <!-- Zone 2: Mind -->
        <section id="mind-zone">
            <div class="flex flex-col md:flex-row-reverse items-center gap-12">
                <div class="flex-1 space-y-6">
                    <h2 class="text-4xl font-bold text-white neon-text-purple">Mind Zone</h2>
                    <p class="text-slate-400 text-lg">Match pairs in <span class="text-white font-semibold">Cosmic Memory</span>.</p>
                    <button onclick="gameManager.start('mind')" class="px-6 py-3 bg-slate-800 hover:bg-purple-600 border border-slate-700 hover:border-purple-500 text-white rounded-lg transition-all duration-300 flex items-center gap-2 group w-full md:w-auto justify-center">
                        Play Cosmic Memory
                    </button>
                </div>
                <div class="flex-1 w-full relative cursor-pointer" onclick="gameManager.start('mind')">
                    <div class="absolute inset-0 bg-purple-600 rounded-2xl blur opacity-20"></div>
                    <div class="relative bg-slate-800 rounded-2xl p-2 border border-slate-700 aspect-video flex items-center justify-center hover:scale-[1.02] transition">
                        <h3 class="text-2xl font-bold text-white">PLAY NOW</h3>
                    </div>
                </div>
            </div>
        </section>

        <!-- Zone 3: Zen -->
        <section id="zen-zone">
            <div class="flex flex-col md:flex-row items-center gap-12">
                <div class="flex-1 space-y-6">
                    <h2 class="text-4xl font-bold text-white neon-text-green">Zen Zone</h2>
                    <p class="text-slate-400 text-lg">Relax with <span class="text-white font-semibold">Flow Garden</span> particles.</p>
                    <button onclick="gameManager.start('zen')" class="px-6 py-3 bg-slate-800 hover:bg-green-600 border border-slate-700 hover:border-green-500 text-white rounded-lg transition-all duration-300 flex items-center gap-2 group w-full md:w-auto justify-center">
                        Enter Flow Garden
                    </button>
                </div>
                <div class="flex-1 w-full relative cursor-pointer" onclick="gameManager.start('zen')">
                    <div class="absolute inset-0 bg-green-600 rounded-2xl blur opacity-20"></div>
                    <div class="relative bg-slate-800 rounded-2xl p-2 border border-slate-700 aspect-video flex items-center justify-center hover:scale-[1.02] transition">
                        <h3 class="text-2xl font-bold text-white">PLAY NOW</h3>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="bg-slate-900 border-t border-slate-800 py-8 text-center text-slate-500">
        <p class="brand-font text-lg text-slate-300 mb-2">ZONER</p>
        <p>&copy; 2024 Zoner Games.</p>
    </footer>

    <!-- GAME OVERLAY -->
    <div id="game-container">
        <div class="absolute top-0 left-0 w-full h-16 flex justify-between items-center px-6 bg-slate-900/50 backdrop-blur-sm z-50">
            <div class="text-white font-bold text-xl brand-font" id="game-title">GAME</div>
            <div class="flex items-center gap-4">
                <div id="game-score" class="text-blue-400 font-mono text-xl">Score: 0</div>
                <button onclick="gameManager.close()" class="bg-red-500/20 hover:bg-red-500 text-red-400 hover:text-white border border-red-500/50 rounded-full px-4 py-1 transition text-sm font-bold">EXIT</button>
            </div>
        </div>

        <canvas id="gameCanvas" class="hidden"></canvas>
        <div id="htmlGameArea" class="hidden"></div>

        <!-- Game Over Menu -->
        <div id="game-menu" class="absolute inset-0 flex items-center justify-center bg-black/80 z-50 hidden">
            <div class="bg-slate-800 border border-slate-700 p-8 rounded-xl text-center shadow-2xl max-w-sm mx-auto w-full m-4">
                <h3 id="menu-title" class="text-2xl text-white font-bold mb-2">Game Over</h3>
                <p id="menu-score" class="text-blue-400 text-xl font-mono mb-6">Score: 150</p>
                <button onclick="gameManager.restart()" class="w-full py-3 bg-blue-600 hover:bg-blue-500 text-white rounded font-bold mb-3">Play Again</button>
                <button onclick="gameManager.close()" class="w-full py-3 bg-slate-700 hover:bg-slate-600 text-white rounded">Back to Portal</button>
            </div>
        </div>
    </div>

    <script>
        /* --- FIXED GAME ENGINE --- */
        const container = document.getElementById('game-container');
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const htmlArea = document.getElementById('htmlGameArea');
        const gameTitle = document.getElementById('game-title');
        const gameScoreDisplay = document.getElementById('game-score');
        const menu = document.getElementById('game-menu');
        const menuTitle = document.getElementById('menu-title');
        const menuScore = document.getElementById('menu-score');

        let animationFrameId;
        let currentGame = null;

        // --- Game Manager ---
        const gameManager = {
            active: false,
            score: 0,
            
            start: function(type) {
                console.log("Starting game:", type); // Debug log
                this.active = true;
                this.score = 0;
                currentGame = type;
                
                container.style.display = 'flex';
                menu.classList.add('hidden');
                htmlArea.innerHTML = ''; 
                
                if(type === 'reflex') {
                    canvas.classList.remove('hidden');
                    htmlArea.classList.add('hidden');
                    gameTitle.innerText = "NEON AIM";
                    gameScoreDisplay.innerText = "Score: 0";
                    this.resizeCanvas();
                    reflexGame.init();
                } else if (type === 'mind') {
                    canvas.classList.add('hidden');
                    htmlArea.classList.remove('hidden');
                    gameTitle.innerText = "COSMIC MEMORY";
                    gameScoreDisplay.innerText = "Moves: 0";
                    mindGame.init();
                } else if (type === 'zen') {
                    canvas.classList.remove('hidden');
                    htmlArea.classList.add('hidden');
                    gameTitle.innerText = "FLOW GARDEN";
                    gameScoreDisplay.innerText = "Relax";
                    this.resizeCanvas();
                    zenGame.init();
                }
            },
            
            resizeCanvas: function() {
                // Set internal resolution to match CSS display size for sharpness
                // and to fix mouse coordinate bugs
                const rect = canvas.getBoundingClientRect();
                // If rect is 0 (first load invisible), default to window
                const w = rect.width > 0 ? rect.width : window.innerWidth * 0.9;
                const h = rect.height > 0 ? rect.height : window.innerHeight * 0.8;
                
                // We use a 2x multiplier for Retina/High DPI screens, then scale down with CSS
                const dpr = window.devicePixelRatio || 1;
                canvas.width = w * dpr;
                canvas.height = h * dpr;
                
                // Normalize context scale
                ctx.scale(dpr, dpr);
                
                // Store logical size for game calcs
                this.logicalWidth = w;
                this.logicalHeight = h;
            },

            end: function(finalScoreText, titleText = "Game Over") {
                this.active = false;
                menu.classList.remove('hidden');
                menuTitle.innerText = titleText;
                menuScore.innerText = finalScoreText;
            },

            restart: function() {
                this.start(currentGame);
            },

            close: function() {
                container.style.display = 'none';
                if(animationFrameId) cancelAnimationFrame(animationFrameId);
                currentGame = null;
                this.active = false;
            },
            
            updateScore: function(val, prefix="Score: ") {
                this.score = val;
                gameScoreDisplay.innerText = prefix + val;
            }
        };

        // Update canvas size if window resizes
        window.addEventListener('resize', () => {
            if(gameManager.active && currentGame !== 'mind') gameManager.resizeCanvas();
        });

        // --- Game 1: Reflex (Neon Aim) ---
        const reflexGame = {
            targets: [],
            timer: 0,
            gameDuration: 1800,
            
            init: function() {
                this.targets = [];
                this.timer = this.gameDuration;
                
                // CLICK HANDLER WITH COORDINATE FIX
                const clickHandler = (e) => {
                    if(!gameManager.active) return;
                    
                    const rect = canvas.getBoundingClientRect();
                    // IMPORTANT: Scale mouse coordinates to match Canvas resolution
                    // Note: Since we used dpr scaling in resizeCanvas, we divide back or just use logical coords
                    // Simplest way: Map click relative to rect directly to logical size
                    
                    let clientX, clientY;
                    if(e.changedTouches) {
                        clientX = e.changedTouches[0].clientX;
                        clientY = e.changedTouches[0].clientY;
                    } else {
                        clientX = e.clientX;
                        clientY = e.clientY;
                    }
                    
                    const x = clientX - rect.left;
                    const y = clientY - rect.top;
                    
                    for(let i = this.targets.length - 1; i >= 0; i--) {
                        const t = this.targets[i];
                        // Check distance
                        const dist = Math.hypot(t.x - x, t.y - y);
                        
                        if(dist < t.radius + 10) { // +10 buffer for fingers
                            gameManager.updateScore(gameManager.score + 10);
                            this.targets.splice(i, 1);
                            break;
                        }
                    }
                };
                
                canvas.onmousedown = clickHandler;
                canvas.ontouchstart = (e) => { e.preventDefault(); clickHandler(e); };
                
                this.loop();
            },

            loop: function() {
                if (!gameManager.active || currentGame !== 'reflex') return;
                
                // Clear screen
                ctx.clearRect(0, 0, gameManager.logicalWidth, gameManager.logicalHeight);
                
                this.timer--;
                
                // Spawn Logic
                if (this.timer % 40 === 0) {
                    const r = 40;
                    this.targets.push({
                        x: r + Math.random() * (gameManager.logicalWidth - r*2),
                        y: r + Math.random() * (gameManager.logicalHeight - r*2),
                        radius: r,
                        color: `hsl(${Math.random() * 360}, 70%, 60%)`,
                        shrink: 0.2
                    });
                }
                
                // Draw Targets
                for(let i = this.targets.length - 1; i >= 0; i--) {
                    let t = this.targets[i];
                    t.radius -= t.shrink;
                    
                    if(t.radius <= 0) {
                        this.targets.splice(i, 1);
                        continue;
                    }
                    
                    ctx.beginPath();
                    ctx.arc(t.x, t.y, t.radius, 0, Math.PI * 2);
                    ctx.fillStyle = t.color;
                    ctx.fill();
                    ctx.lineWidth = 3;
                    ctx.strokeStyle = 'white';
                    ctx.stroke();
                    
                    // Center dot
                    ctx.beginPath();
                    ctx.arc(t.x, t.y, 5, 0, Math.PI*2);
                    ctx.fillStyle = 'white';
                    ctx.fill();
                }
                
                // Timer Bar
                ctx.fillStyle = '#3b82f6';
                const pct = this.timer / this.gameDuration;
                ctx.fillRect(0, gameManager.logicalHeight - 6, pct * gameManager.logicalWidth, 6);

                if(this.timer <= 0) {
                    gameManager.end("